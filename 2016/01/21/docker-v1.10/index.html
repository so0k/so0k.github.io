<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Docker v1.10  &middot; Guides and Notes by Vincent</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="My notes on the upcoming Docker 1.10 Release Candidate" />

<meta name="keywords" content="Docker, ">


<meta property="og:title" content="Docker v1.10  &middot; Guides and Notes by Vincent ">
<meta property="og:site_name" content="Guides and Notes by Vincent"/>
<meta property="og:url" content="http://so0k.github.io/2016/01/21/docker-v1.10/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content="My notes on the upcoming Docker 1.10 Release Candidate"/>
<meta property="og:article:published_time" content="2016-01-21T12:52:58&#43;07:00" />
<meta property="og:article:modified_time" content="2016-01-21T12:52:58&#43;07:00" />

  
    
<meta property="og:article:tag" content="Docker">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@vincentdesmet" />
<meta name="twitter:creator" content="@vincentdesmet" />
<meta name="twitter:title" content="Docker v1.10" />
<meta name="twitter:description" content="My notes on the upcoming Docker 1.10 Release Candidate" />
<meta name="twitter:url" content="http://so0k.github.io/2016/01/21/docker-v1.10/" />
<meta name="twitter:domain" content="http://so0k.github.io/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Docker v1.10",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-01-21",
    "description": "My notes on the upcoming Docker 1.10 Release Candidate",
    "wordCount":  856 
  }
</script>



<link rel="canonical" href="http://so0k.github.io/2016/01/21/docker-v1.10/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://so0k.github.io/touch-icon-144-precomposed.png">
<link href="http://so0k.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="http://so0k.github.io/css/theme/flatly.css">


<link rel="stylesheet" href="http://so0k.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="http://so0k.github.io/css/style.css">


  <link rel="stylesheet" href="http://so0k.github.io/css/highlight/default.css">


</head>
<body>
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://so0k.github.io/">Guides and Notes by Vincent</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li>

            <a href="http://so0k.github.io/page/about"
            >

            
                <i class="fa fa-info-circle"></i>
            
            
            About Me
            </a>
          </li>
          
          <li>

            <a href="http://so0k.github.io/post"
             title="Show list of posts">

            
                <i class="fa fa-files-o"></i>
            
            
            Posts
            </a>
          </li>
          
          <li>

            <a href="https://feedburner.google.com/fb/a/mailverify?uri=so0k&amp;amp;loc=en_US"
            >

            
                <i class="fa fa-envelope"></i>
            
            
            Subscribe
            </a>
          </li>
          
          <li>

            <a href="http://so0k.github.io/tags"
             title="Show list of tags">

            
                <i class="fa fa-tags"></i>
            
            
            Tags
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
<div class="row">

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>Docker v1.10
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2016-01-21">21 Jan, 2016</time>
</small>


  <small>
    &middot; by Vincent De Smet
  
  &middot; Read in about 5 min
  &middot; (856 Words)
</small>


<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="http://so0k.github.io/tags/docker" class="label label-primary">Docker</a>
  
  <a href="http://so0k.github.io/tags/rc" class="label label-primary">RC</a>
  


</div>
<br>
</div>

  </div>
</div>

  <div class="container content">
  

<p><strong>Docker 1.10 is coming</strong> and as with any release in the ever fast moving world of Docker, it is good to find out more about the use cases for the newly introduced commands, below is a list of the interesting changes that stood out for me so far:</p>

<h3 id="container-mutability-and-the-new-docker-update-command">Container Mutability and the new <code>docker update</code> command</h3>

<p><a href="https://github.com/docker/docker/pull/15078">Relevant pull request</a></p>

<pre><code>Usage: docker update [OPTIONS] CONTAINER [CONTAINER...]

Updates container resource limits

  --blkio-weight=0           Block IO (relative weight), between 10 and 1000
  --cpu-shares=0             CPU shares (relative weight)
  --cpu-period=0             Limit the CPU CFS (Completely Fair Scheduler) period
  --cpu-quota=0              Limit the CPU CFS (Completely Fair Scheduler) quota
  --cpuset-cpus=&quot;&quot;           CPUs in which to allow execution (0-3, 0,1)
  --cpuset-mems=&quot;&quot;           Memory nodes (MEMs) in which to allow execution (0-3, 0,1)
  -m, --memory=&quot;&quot;            Memory limit
  --memory-reservation=&quot;&quot;    Memory soft limit
  --memory-swap=&quot;&quot;           Total memory (memory + swap), '-1' to disable swap
  --kernel-memory=&quot;&quot;         Kernel memory limit: container must be stopped
</code></pre>

<p>The docker update command dynamically updates container resources. Use this command to prevent containers from consuming too many resources from their Docker host. With a single command, you can place limits on a single container or on many. To specify more than one container, provide space-separated list of container names or IDs.</p>

<p>With the exception of the <code>--kernel-memory</code> value, you can specify these options on a running or a stopped container. You can only update <code>--kernel-memory</code> on a stopped container. When you run docker update on stopped container, the next time you restart it, the container uses those values.</p>

<p>Prior to 1.10, once the Docker Daemon created a container for the Image you chose to run, it did not give you an easy way to change the configuration you specified with the <code>docker run</code> command.</p>

<p>From a technical perspective, Docker exposes a layer above a set of technologies (cgroups, namespaces, iptables, filesystems, &hellip;) to provide its users an easy way of managing these resources for their applications. One could always dig into these layers to make adjustments behind the daemons&rsquo; back.</p>

<p>For example:</p>

<ol>
<li><p><a href="http://stackoverflow.com/questions/19897743/exposing-a-port-on-a-live-docker-container">Exposing ports on a live container</a>:</p>

<p>This Stack Overflow question gives us this very usefull snippet</p>

<pre><code>#get the container IP
CONTAINER_IP=$(docker inspect -f '{{ .NetworkSettings.IPAddress }}' container_name)
#forward packets from port 8001 on your host to port 8000 on the container
iptables -t nat -A DOCKER -p tcp --dport 8001 -j DNAT --to-destination ${CONTAINER_IP}:8000
</code></pre>

<p><a href="http://superuser.com/questions/803772/remove-exposed-port-from-docker/808124">See Also</a></p></li>

<li><p><a href="https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/">Managing Docker resources with Cgroups</a> (September 2014)</p>

<p>Either by interacting with <code>cgroups</code> directly or if running Docker with Systemd, using <code>systemctl</code> to set properties on the systemd scope of the container, also refer to the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Resource_Management_Guide/">Redhat Resource Management Guide</a> &amp; <a href="http://www.freedesktop.org/software/systemd/man/systemd.resource-control.html">systemd resource control</a>:</p>

<pre><code>sudo systemctl set-property docker-4be96b853089bc6044b29cb873cac460b429cfcbdd0e877c0868eb2a901dbf80.scope CPUShares=512
#show all the properties:
systemctl show docker-4be96b853089bc6044b29cb873cac460b429cfcbdd0e877c0868eb2a901dbf80.scope
</code></pre></li>

<li><p><a href="https://jpetazzo.github.io/2015/01/13/docker-mount-dynamic-volumes/">Attaching Volumes to a running container</a></p>

<p>&hellip;</p></li>
</ol>

<p>But going behind the back of the Docker Daemon does not provide any logs or audit trails and may cause unexpected side effects, moreover - giving users the ability apply these changes through the Docker API only makes sense given it is possible to achieve underneath&hellip; but up to what point?</p>

<p>This brings us to a very important question: <strong>How much of a container should be mutable?</strong></p>

<p>With Docker 1.9, networks could be <a href="https://docs.docker.com/engine/reference/commandline/network_connect/">connected &amp; disconnected</a> from a Container and containers could be <a href="https://docs.docker.com/engine/reference/commandline/rename/">renamed</a> while all other aspects are immutable from the Docker daemon&rsquo;s perspective.</p>

<p>With the addition of the <a href="https://github.com/docker/docker/blob/v1.10.0-rc1/docs/reference/commandline/update.md"><code>docker update</code></a> command in 1.10, CPU/Memory resources can be changed dynamically (except the <code>--kernel-memory</code> setting which requires a container restart) and are persisted in the container definition to ensure they still apply after restarts.</p>

<p>Adding support for exposing ports, changing container restart policies and <a href="https://github.com/docker/docker/pull/18958">labels</a> are being worked on , but do not seem to be planned for the 1.10 release, but what about <code>Environment variables</code>?</p>

<h3 id="container-network-model-service-discovery">Container Network Model - Service Discovery</h3>

<p>With the 1.9 release, Docker moved its networking libraries from the experimental branch to the production ready branch. Networking brought a big change in the way containers find each other, deprecating Docker links as well as adding cross-host support with overlay (vxlan) networks (replacing the ambassador container pattern).</p>

<p>Docker links worked by modifying the <code>/etc/hosts</code> files within the containers, bypassing DNS lookups. The new networking model built further on this approach to provide cluster wide service discovery. Unfortunately, making changes to a shared resource (<code>/etc/hosts</code>) in a non-atomic way and scaling <a href="https://github.com/docker/docker/issues/17190">will never go hand in hand</a>. The service discovery model was in desperate need for a change.</p>

<p>As highlighted by Ahmet Alp Balkan in his <a href="https://youtu.be/WXESsPqC8to">excellent DockerCon EU 2015 presentation</a>, most Service Discovery solutions gravitate towards the tested and proven DNS protocol. Some of the drawbacks highlighted such as IP caching and no respect for TLS are solved by Cluster Management Systems such as Kubernetes by fully decoupling the service endpoint from the implementation through labels and fixed IP service resources.</p>

<p>The fix by the Docker networking team for 1.10 would be to <a href="https://github.com/docker/docker/issues/17195">bundle a DNS server with the Docker Daemon</a> and expose this service within the namespace of every container. This would certainly be a much better solution than the current one, but the fact that <strong>neither the previous <code>/etc/hosts</code> nor the upcoming DNS server are <em>optional</em></strong> is still <a href="http://blog.kubernetes.io/2016/01/why-Kubernetes-doesnt-use-libnetwork.html">not making some people happy</a>.</p>

</div>


  <footer>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="http://so0k.github.io/2016/01/13/how-to-kill-a-hanging-hyper-v-vm/" title="How to Kill a Hanging Hyper-V VM">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="http://so0k.github.io/2016/02/24/how-to-quickly-group-flatfile-records-and-get-a-grouped-field-maximum/" title="How to quickly group FlatFile records and get a grouped Field maximum">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>


</div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  

</div>


    
<div class="container copyright">
  
  Copyright &copy; 2015. All rights reserved.


</div>



          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="http://so0k.github.io/js/jquery.min-2.1.4.js"></script>
<script src="http://so0k.github.io/js/bootstrap.min-3.3.5.js"></script>




<script src="http://so0k.github.io/js/highlight.pack.js"></script>
<script src="http://so0k.github.io/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-72129772-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


  </body>
</html>

