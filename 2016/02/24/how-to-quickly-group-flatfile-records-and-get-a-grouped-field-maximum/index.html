<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>How to quickly group FlatFile records and get a grouped Field maximum  &middot; Guides and Notes by Vincent</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="I had a flat file of records and needed to figure out the maximum length of a particular field after filtering and grouping the records, here&#39;s how." />

<meta name="keywords" content="Powershell, Maximum, Group, ">


<meta property="og:title" content="How to quickly group FlatFile records and get a grouped Field maximum  &middot; Guides and Notes by Vincent ">
<meta property="og:site_name" content="Guides and Notes by Vincent"/>
<meta property="og:url" content="http://so0k.github.io/2016/02/24/how-to-quickly-group-flatfile-records-and-get-a-grouped-field-maximum/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content="I had a flat file of records and needed to figure out the maximum length of a particular field after filtering and grouping the records, here&#39;s how."/>
<meta property="og:article:published_time" content="2016-02-24T17:10:02&#43;07:00" />
<meta property="og:article:modified_time" content="2016-02-24T17:10:02&#43;07:00" />

  
    
<meta property="og:article:tag" content="Powershell">
    
<meta property="og:article:tag" content="Maximum">
    
<meta property="og:article:tag" content="Group">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@vincentdesmet" />
<meta name="twitter:creator" content="@vincentdesmet" />
<meta name="twitter:title" content="How to quickly group FlatFile records and get a grouped Field maximum" />
<meta name="twitter:description" content="I had a flat file of records and needed to figure out the maximum length of a particular field after filtering and grouping the records, here&#39;s how." />
<meta name="twitter:url" content="http://so0k.github.io/2016/02/24/how-to-quickly-group-flatfile-records-and-get-a-grouped-field-maximum/" />
<meta name="twitter:domain" content="http://so0k.github.io/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "How to quickly group FlatFile records and get a grouped Field maximum",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-02-24",
    "description": "I had a flat file of records and needed to figure out the maximum length of a particular field after filtering and grouping the records, here\x27s how.",
    "wordCount":  355 
  }
</script>



<link rel="canonical" href="http://so0k.github.io/2016/02/24/how-to-quickly-group-flatfile-records-and-get-a-grouped-field-maximum/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://so0k.github.io/touch-icon-144-precomposed.png">
<link href="http://so0k.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="http://so0k.github.io/css/theme/flatly.css">


<link rel="stylesheet" href="http://so0k.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="http://so0k.github.io/css/style.css">


  <link rel="stylesheet" href="http://so0k.github.io/css/highlight/default.css">


</head>
<body>
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://so0k.github.io/">Guides and Notes by Vincent</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li>

            <a href="http://so0k.github.io/page/about"
            >

            
                <i class="fa fa-info-circle"></i>
            
            
            About Me
            </a>
          </li>
          
          <li>

            <a href="http://so0k.github.io/post"
             title="Show list of posts">

            
                <i class="fa fa-files-o"></i>
            
            
            Posts
            </a>
          </li>
          
          <li>

            <a href="https://feedburner.google.com/fb/a/mailverify?uri=so0k&amp;amp;loc=en_US"
            >

            
                <i class="fa fa-envelope"></i>
            
            
            Subscribe
            </a>
          </li>
          
          <li>

            <a href="http://so0k.github.io/tags"
             title="Show list of tags">

            
                <i class="fa fa-tags"></i>
            
            
            Tags
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
<div class="row">

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>How to quickly group FlatFile records and get a grouped Field maximum
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2016-02-24">24 Feb, 2016</time>
</small>


  <small>
    &middot; by Vincent De Smet
  
  &middot; Read in about 2 min
  &middot; (355 Words)
</small>


<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="http://so0k.github.io/tags/powershell" class="label label-primary">Powershell</a>
  


</div>
<br>
</div>

  </div>
</div>

  <div class="container content">
  <p>If the data was in a RDBMS you&rsquo;d simply <code>GROUP BY Field1</code> and <code>SELECT MAX(Field2)</code>.</p>

<p>However, all I got are: FlatFiles, little time and PowerShell, so Let&rsquo;s GO!</p>

<p>First, I have to filter down records in the file based on the first 3 characters of each line, only <code>ANV</code> records were of interest to me, let me load these records in memory real fast:</p>

<pre><code>$ANV=gc SSRF-FAH.BAK | ? { $_.substring(0,3) -eq &quot;ANV&quot; }
</code></pre>

<p>Great, let&rsquo;s have a look at what the first few records we just loaded look like:</p>

<pre><code>$ANV | Select -First 10
</code></pre>

<p>Which gives me:</p>

<pre><code>ANVA182007                                                                   20130425...
ANVA182600                                                                   20120829...
ANVA182607                                                                   20130425...
ANVA188001                                                                   20120829...
ANVA188010                                                                   20120829...
ANVA188011                                                                   20120829...
ANVA188012                                                                   20120829...
ANVA188014                                                                   20120829...
ANVA188016                                                                   20120829...
ANVA190000                                                                   20120829...
</code></pre>

<p>I only care about the first 20 characters and only the last 2 record fields listed below:</p>

<table>
<thead>
<tr>
<th>Field</th>
<th>Start</th>
<th>Length</th>
</tr>
</thead>

<tbody>
<tr>
<td>RecordType</td>
<td>00</td>
<td>03</td>
</tr>

<tr>
<td>Category</td>
<td>03</td>
<td>02</td>
</tr>

<tr>
<td>Code</td>
<td>05</td>
<td>15</td>
</tr>
</tbody>
</table>

<p>Let&rsquo;s create some custom properties to display this data</p>

<pre><code>$ANV | Select `
@{Name=&quot;Category&quot;;Expression={$_.Substring(3,2)}}, `
@{Name=&quot;Code&quot;;Expression={$_.Substring(5,15)}} `
| Select -First 10
</code></pre>

<p>I actually only want the length of the codes, so this becomes:</p>

<pre><code> $ANV | Select `
 @{Name=&quot;Category&quot;;Expression={$_.Substring(3,2)}}, `
 @{Name=&quot;CodeLength&quot;;Expression={$_.Substring(5,15).trim().Length}} `
 | Select -First 10
</code></pre>

<p>Now let&rsquo;s group by <code>Category</code>:</p>

<pre><code>$ANV | Select `
@{Name=&quot;Category&quot;;Expression={$_.Substring(3,2)}}, `
@{Name=&quot;CodeLength&quot;;Expression={$_.Substring(5,15).trim().Length}} | `
Group Category | Select -First 10
</code></pre>

<p>This gives us the following</p>

<pre><code>Count Name                      Group
----- ----                      -----
   16 A1                        {@{Category=A1; CodeLength=5}, @{Category=A1; Code...}}
   13 A3                        {@{Category=A3; CodeLength=4}, @{Category=A3; Code...}}
  530 A4                        {@{Category=A4; CodeLength=1}, @{Category=A4; Code...}}
  351 A6                        {@{Category=A6; CodeLength=4}, @{Category=A6; Code...}}
    1 A7                        {@{Category=A7; CodeLength=5}}
    3 C4                        {@{Category=C4; CodeLength=1}, @{Category=C4; Code...}}
  216 I1                        {@{Category=I1; CodeLength=3}, @{Category=I1; Code...}}
    3 I3                        {@{Category=I3; CodeLength=1}, @{Category=I3; Code...}}
    8 I4                        {@{Category=I4; CodeLength=2}, @{Category=I4; Code...}}
   40 M0                        {@{Category=M0; CodeLength=4}, @{Category=M0; Code...}}
</code></pre>

<p>Great, only thing left to do is get the maximum <code>CodeLength</code> per <code>Category</code>&hellip; most Google results tell you to sort and select the first:</p>

<pre><code>$ANV | Select `
@{Name=&quot;Category&quot;;Expression={$_.Substring(3,2)}}, `
@{Name=&quot;CodeLength&quot;;Expression={$_.Substring(5,15).trim().Length}} | `
Group Category | %{ $_.Group | Sort CodeLength -Descending | Select -First 1 }
</code></pre>

<p>Exactly what I needed:</p>

<pre><code>Category CodeLength
-------- ----------
A1                5
A3                4
A4                9
A6                5
A7                5
C4                1
...
</code></pre>

<p>Now back to the boring parts :(</p>

</div>


  <footer>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="http://so0k.github.io/2016/01/21/docker-v1.10/" title="Docker v1.10">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>


</div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  

</div>


    
<div class="container copyright">
  
  Copyright &copy; 2015. All rights reserved.


</div>



          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="http://so0k.github.io/js/jquery.min-2.1.4.js"></script>
<script src="http://so0k.github.io/js/bootstrap.min-3.3.5.js"></script>




<script src="http://so0k.github.io/js/highlight.pack.js"></script>
<script src="http://so0k.github.io/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-72129772-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


  </body>
</html>

